<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kuis trias politica</title>
    <style>
      :root {
        --bg: #060000; /* slate-900 */
        --card: #111827; /* gray-900 */
        --muted: #334155; /* slate-600 */
        --text: #ffffff; /* gray-200 */
        --accent: #38bdf8; /* sky-400 */
        --accent-2: #22c55e; /* green-500 */
        --danger: #ef4444; /* red-500 */
        --warn: #f59e0b; /* amber-500 */
        --shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
        --radius: 16px;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial;
        background: radial-gradient(
            1200px 800px at 10% -10%,
            #1e293b,
            transparent
          ),
          radial-gradient(800px 600px at 120% 0%, #0b3b47, transparent),
          var(--bg);
        color: var(--text);
        min-height: 100svh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }
      .app {
        width: 100%;
        max-width: 980px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 16px;
      }
      .brand {
        font-weight: 800;
        letter-spacing: 0.5px;
        font-size: clamp(18px, 3.5vw, 24px);
      }
      .timer {
        font-variant-numeric: tabular-nums;
        font-weight: 700;
        padding: 10px 14px;
        border-radius: 999px;
        background: #0b1220;
        border: 1px solid #1f2a44;
        box-shadow: var(--shadow);
      }
      .card {
        background: linear-gradient(180deg, #0b1220, #0a1020);
        border: 1px solid #1f2a44;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
      }
      .section {
        display: none;
      }
      .active {
        display: block;
      }
      .card-inner {
        padding: 20px;
      }
      .grid {
        display: grid;
        gap: 16px;
      }
      .grid-2 {
        grid-template-columns: 1fr 1fr;
      }
      .grid-responsive {
        grid-template-columns: 1fr;
      }
      @media (min-width: 720px) {
        .grid-responsive {
          grid-template-columns: 1fr 320px;
        }
      }

      input[type="text"],
      input[type="password"] {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid #26314d;
        background: #0b1220;
        color: var(--text);
        outline: none;
        box-shadow: inset 0 0 0 9999px rgba(255, 255, 255, 0);
      }
      label {
        font-size: 14px;
        color: #cbd5e1;
      }
      .btn {
        cursor: pointer;
        padding: 12px 16px;
        border-radius: 14px;
        background: var(--accent);
        color: #001219;
        border: none;
        font-weight: 700;
        box-shadow: var(--shadow);
        transition: 0.2s transform ease;
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn.secondary {
        background: #1f2937;
        color: #e2e8f0;
        border: 1px solid #334155;
      }
      .btn.warn {
        background: var(--warn);
        color: #0b1220;
      }
      .btn.danger {
        background: var(--danger);
        color: #0b1220;
      }
      .muted {
        color: #94a3b8;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        background: #0b1220;
        border: 1px solid #223156;
        font-size: 12px;
        color: #cbd5e1;
      }

      .question-area {
        display: flex;
        flex-direction: column;
        gap: 14px;
      }
      .q-title {
        font-weight: 800;
        font-size: 18px;
      }
      .choices {
        display: grid;
        gap: 10px;
      }
      .choice {
        display: flex;
        gap: 10px;
        align-items: flex-start;
        border: 1px solid #1f2a44;
        background: #0b1220;
        padding: 12px;
        border-radius: 12px;
        cursor: pointer;
      }
      .choice input {
        margin-top: 4px;
      }

      .nav {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        max-height: 240px;
        overflow: auto;
        padding: 10px;
      }
      .nav button {
        width: 44px;
        height: 40px;
        border-radius: 10px;
        border: 1px solid #1f2a44;
        background: #0b1220;
        color: #cbd5e1;
        font-weight: 700;
        cursor: pointer;
      }
      .nav button.active {
        outline: 2px solid var(--accent);
        color: #0ea5e9;
      }
      .nav button.done {
        background: #07291f;
        border-color: #0b7a53;
        color: #34d399;
      }

      .footer-actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-top: 10px;
      }

      .legend {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .results {
        display: grid;
        gap: 12px;
      }
      .score-box {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .score-card {
        background: #0b1220;
        border: 1px solid #1f2a44;
        border-radius: 14px;
        padding: 14px;
      }

      .info-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <div class="app">
      <header>
        <div class="brand">kuis trias politica</div>
        <div class="pill" id="infoUser">Belum login</div>
        <div class="timer" id="timer">20:00</div>
      </header>

      <!-- SECTION 1: FORM MINIMAL -->
      <section id="section-form" class="section active">
        <div class="card">
          <div class="card-inner grid">
            <div>
              <h2 style="margin: 0 0 10px 0">Masuk Kuis</h2>
              <p class="muted" style="margin-top: 0">
                Masukkan nama dan password untuk memulai. Tidak ada pengaturan
                tambahan.
              </p>
              <div class="grid">
                <div>
                  <label for="nama">Nama</label>
                  <input id="nama" type="text" placeholder="Nama peserta" />
                </div>
                <div>
                  <label for="pass">Password</label>
                  <input id="pass" type="password" placeholder="Password" />
                </div>
                <button class="btn" id="btnMulai">Mulai Kuis</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION 2: QUIZ -->
      <section id="section-quiz" class="section">
        <div class="grid grid-responsive">
          <div class="card">
            <div class="card-inner">
              <div class="info-row">
                <div class="pill" id="infoKategori">Kategori: -</div>
                <div class="pill" id="infoSoal">Soal 0 / 180</div>
              </div>
              <div class="question-area" id="questionArea">
                <!-- Question inject here -->
              </div>
              <div class="footer-actions">
                <button class="btn secondary" id="prevBtn">Prev</button>
                <div class="legend">
                  <span class="pill">• Biru = aktif</span>
                  <span
                    class="pill"
                    style="
                      background: #07291f;
                      color: #34d399;
                      border-color: #0b7a53;
                    "
                    >• Hijau = terjawab</span
                  >
                </div>
                <button class="btn" id="nextBtn">Next</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-inner">
              <h3 style="margin-top: 0">Navigasi Soal</h3>
              <div class="nav" id="nav">
                <!-- Nav buttons injected here -->
              </div>
              <div class="grid" style="margin-top: 8px">
                <button class="btn warn" id="btnSubmit">
                  Kumpulkan Jawaban
                </button>
                <button class="btn danger" id="btnReset">Reset Jawaban</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION 3: HASIL -->
      <section id="section-result" class="section">
        <div class="card">
          <div class="card-inner results">
            <h2 style="margin: 0">Hasil Ujian</h2>
            <p class="muted" id="resultUser">Peserta: -</p>
            <div class="score-box">
              <div class="score-card" style="grid-column: span 2">
                <div class="muted">Total Skor</div>
                <div id="scoreTotal" style="font-size: 30px; font-weight: 900">
                  0 / 180
                </div>
              </div>
            </div>
            <div>
              <button class="btn" id="btnUlang">Mulai Lagi</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <script>
      /** UTIL **/
      const el = (sel) => document.querySelector(sel);
      const els = (sel) => Array.from(document.querySelectorAll(sel));
      const shuffle = (arr) =>
        arr
          .map((v) => [Math.random(), v])
          .sort((a, b) => a[0] - b[0])
          .map((x) => x[1]);

      /** BANK SOAL (40/40/40) **/
      // Format: {type:'sinonim'|'antonim'|'hiponim', q:'', options:['','','',''], answer: index}

      const SOAL_fungsi = [
        {
          q: "Sebuah Undang-Undang yang disahkan DPR dan ditandatangani Presiden dianggap oleh sekelompok warga negara telah melanggar hak konstitusional mereka. Mekanisme konstitusional yang paling tepat untuk menyelesaikan masalah ini sesuai prinsip checks and balances adalah mengajukan permohonan judicial review kepada...",
          o: [
            "Mahkamah Agung (MA)",
            "Mahkamah Konstitusi (MK)",
            "Komisi Yudisial (KY)",
            "Dewan Perwakilan Daerah (DPD)",
            "Badan Pemeriksa Keuangan (BPK)",
          ],
          a: 1,
        },
        {
          q: "Presiden mengeluarkan Peraturan Pemerintah Pengganti Undang-Undang (Perppu) dalam keadaan mendesak. DPR menolak Perppu tersebut dalam sidang paripurna. Konsekuensi konstitusional dari penolakan DPR ini adalah...",
          o: [
            "Perppu tersebut tetap berlaku sepanjang tidak ada keputusan Mahkamah Konstitusi.",
            "Presiden wajib mencabut Perppu tersebut dan mengajukan Rancangan Undang-Undang (RUU) baru.",
            "Perppu tersebut batal dengan sendirinya dan tidak memiliki kekuatan hukum.",
            "Presiden dapat mengajukan gugatan ke Mahkamah Konstitusi terhadap keputusan DPR.",
            "MPR dapat melakukan intervensi untuk memutuskan apakah Perppu tersebut dapat diteruskan.",
          ],
          a: 2,
        },
        {
          q: "Lembaga-lembaga negara seperti Komisi Pemberantasan Korupsi (KPK), Ombudsman Republik Indonesia, dan Komisi Nasional Hak Asasi Manusia (Komnas HAM) tidak dapat diklasifikasikan secara murni ke dalam cabang legislatif, eksekutif, maupun yudikatif. Keberadaan lembaga-lembaga tersebut menunjukkan bahwa sistem pemerintahan Indonesia menganut...",
          o: [
            "Trias Politika murni ala Montesquieu.",
            "Sistem pemerintahan parlementer.",
            "Mekanisme checks and balances dengan lembaga negara independen.",
            "Sentralisasi kekuasaan pada Presiden.",
            "Fusi antara kekuasaan legislatif dan eksekutif.",
          ],
          a: 2,
        },
        {
          q: "DPR menggunakan hak angket untuk menyelidiki dugaan pelanggaran hukum yang dilakukan oleh seorang menteri. Dari perspektif Trias Politika, tindakan DPR ini merupakan wujud dari...",
          o: [
            "Kekuasaan legislatif untuk mengambilalih tugas eksekutif.",
            "Fungsi pengawasan yang merupakan bagian dari mekanisme checks and balances.",
            "Pelanggaran terhadap prinsip kebebasan kerja eksekutif.",
            "Upaya untuk menjatuhkan pemerintahan yang sah.",
            "Kewenangan yudikatif yang dijalankan oleh legislatif.",
          ],
          a: 1,
        },
        {
          q: "Seorang hakim agung terbukti melakukan pelanggaran kode etik berat setelah melalui proses pemeriksaan oleh Komisi Yudisial (KY). Usul pemberhentian hakim tersebut selanjutnya akan disampaikan KY kepada...",
          o: [
            "Presiden untuk ditindaklanjuti dengan Keputusan Presiden.",
            "Mahkamah Agung (MA) untuk melakukan sidang kode etik internal.",
            "Mahkamah Konstitusi (MK) untuk memutuskan konstitusionalitas pemberhentiannya.",
            "Dewan Perwakilan Rakyat (DPR) untuk mendapatkan persetujuan.",
            "Majelis Permusyawaratan Rakyat (MPR) untuk diputuskan dalam sidang paripurna.",
          ],
          a: 0,
        },
        {
          q: "Dalam konteks pembagian kekuasaan di Indonesia, keberadaan DPD yang memiliki kewenangan untuk mengajukan RUU kepada DPR yang hanya berkaitan dengan otonomi daerah menunjukkan adanya...",
          o: [
            "Pemusatan kekuasaan legislatif pada satu kamar.",
            "Pembagian kekuasaan horizontal yang bersifat kamar tunggal (unicameral).",
            "Representasi vertikal dalam sistem legislatif bikameral.",
            "Lemahnya kekuasaan eksekutif pusat terhadap daerah.",
            "Fusi antara kekuasaan legislatif dan yudikatif.",
          ],
          a: 2,
        },
        {
          q: "Presiden menunjuk seorang duta besar setelah mendapat pertimbangan dari DPR. Jika kemudian Presiden ingin memberhentikan duta besar tersebut di tengah masa tugas, mekanisme konstitusional yang harus ditempuh adalah...",
          o: [
            "Presiden dapat memberhentikan secara sepihak tanpa alasan.",
            "Presiden wajib meminta persetujuan terlebih dahulu dari Mahkamah Konstitusi.",
            "Presiden harus meminta pertimbangan kembali dari DPR.",
            "Badan Pemeriksa Keuangan (BPK) harus melakukan audit terlebih dahulu.",
            "Dewan Perwakilan Daerah (DPD) harus memberikan rekomendasi.",
          ],
          a: 2,
        },
        {
          q: "Esensi dari 'kekuasaan kehakiman yang merdeka' sebagaimana diatur dalam UUD 1945 adalah untuk menjamin...",
          o: [
            "Hakim tidak dapat diperiksa oleh lembaga mana pun, termasuk Komisi Yudisial.",
            "Putusan pengadilan bebas dari intervensi kekuasaan legislatif dan eksekutif.",
            "Mahkamah Agung memiliki kekuasaan tertinggi di atas Presiden dan DPR.",
            "Rakyat dapat menentukan hakim yang akan memeriksa perkara mereka.",
            "Eksekutif memiliki kebebasan untuk menafsirkan undang-undang.",
          ],
          a: 1,
        },
        {
          q: "Badan Pemeriksa Keuangan (BPK) memeriksa tanggung jawab keuangan negara yang disampaikan pemerintah (eksekutif). Hasil pemeriksaan BPK diserahkan kepada DPR (legislatif) untuk dijadikan bahan pertimbangan. Hubungan antara BPK, eksekutif, dan legislatif ini mencerminkan...",
          o: [
            "Ketergantungan lembaga yudikatif pada lembaga legislatif.",
            "Pelaksanaan fungsi pengawasan yang merupakan bagian dari kekuasaan legislatif.",
            "Dominasi kekuasaan eksekutif terhadap lembaga negara lain.",
            "Konflik kepentingan antara cabang eksekutif dan legislatif.",
            "Inefektivitas mekanisme checks and balances.",
          ],
          a: 1,
        },
        {
          q: "Mahkamah Konstitusi membatalkan sebuah Undang-Undang karena proses pembentukannya tidak sesuai dengan UUD 1945, meskipun materi muatannya tidak bertentangan. Keputusan MK ini menunjukkan bahwa kekuasaan kehakiman tidak hanya menguji substansi, tetapi juga...",
          o: [
            "Aspek formalitas dan prosedur legislasi.",
            "Kelayakan moral para pembentuk undang-undang.",
            "Dampak ekonomi dari penerapan undang-undang.",
            "Opini publik terhadap undang-undang tersebut.",
            "Kebijakan politik partai pengusul RUU.",
          ],
          a: 0,
        },
        {
          q: "Jika Presiden dan Wakil Presiden berhalangan tetap secara bersamaan dalam masa jabatannya, menurut UUD 1945, kewenangan untuk mengangkat penggantinya hingga habis masa jabatannya berada di tangan...",
          o: [
            "Pemilihan Umum berikutnya.",
            "Mahkamah Konstitusi.",
            "Dewan Perwakilan Rakyat dan Dewan Perwakilan Daerah.",
            "Majelis Permusyawaratan Rakyat.",
            "Ketua Mahkamah Agung.",
          ],
          a: 3,
        },
        {
          q: "Prinsip 'checks and balances' dalam sistem presidensial Indonesia bertujuan untuk mencegah terjadinya...",
          o: [
            "Efisiensi dalam proses pengambilan keputusan pemerintah.",
            "Penyalahgunaan kekuasaan oleh salah satu lembaga negara.",
            "Terlalu banyak partai politik di parlemen.",
            "Dominasi kekuasaan kehakiman terhadap kekuasaan lain.",
            "Keterlambatan dalam penyelesaian perkara di pengadilan.",
          ],
          a: 1,
        },
        {
          q: "Berikut adalah peran lembaga legislatif (DPR/DPD) dalam ranah eksekutif, **kecuali**...",
          o: [
            "Memberikan persetujuan calon Panglima TNI yang diusulkan Presiden.",
            "Mengangkat dan memberhentikan anggota Komisi Yudisial.",
            "Menetapkan Anggaran Pendapatan dan Belanja Negara (APBN).",
            "Memberikan persetujuan terhadap calon duta besar.",
            "Mengajukan pertanyaan (interpelasi) kepada Presiden.",
          ],
          a: 1,
        },
        {
          q: "Sebuah putusan Mahkamah Konstitusi yang bersifat final dan mengikat secara umum, namun dalam pelaksanaannya diabaikan oleh lembaga eksekutif. Situasi ini merupakan ancaman serius bagi...",
          o: [
            "Prinsip demokrasi langsung.",
            "Kedaulatan rakyat yang diwakili oleh Presiden.",
            "Supremasi hukum dan konstitusi.",
            "Efektivitas sistem multi-partai.",
            "Hubungan diplomatik antar negara.",
          ],
          a: 2,
        },
        {
          q: "Konsep Trias Politika yang diterapkan di Indonesia mengalami modifikasi dari teori aslinya. Salah satu buktinya adalah adanya lembaga MPR yang memiliki kewenangan selain dari ketiga cabang kekuasaan, yaitu...",
          o: [
            "Melantik Presiden dan Wakil Presiden.",
            "Mengubah dan menetapkan UUD 1945.",
            "Menetapkan Garis-Garis Besar Haluan Negara (GBHN).",
            "Memberhentikan Presiden atas usulan DPR.",
            "Menetapkan APBN bersama DPR.",
          ],
          a: 1,
        },
        {
          q: "DPR menyatakan pendapat bahwa Presiden telah melakukan pelanggaran hukum berat. Untuk memulai proses pemakzulan (impeachment), langkah selanjutnya yang harus ditempuh adalah...",
          o: [
            "Mahkamah Konstitusi langsung menggelar sidang pemakzulan.",
            "DPR mengajukan permintaan kepada Mahkamah Konstitusi untuk putusan.",
            "MPR mengadakan sidang istimewa tanpa menunggu keputusan MK.",
            "Badan Pemeriksa Keuangan melakukan audit terhadap Presiden.",
            "Komisi Yudisial menyelidiki dugaan pelanggaran tersebut.",
          ],
          a: 1,
        },
        {
          q: "Kewenangan Mahkamah Agung (MA) sebagai pemegang kekuasaan kehakiman tertinggi berbeda dengan Mahkamah Konstitusi (MK). Perbedaan pokok kewenangan tersebut adalah MA berwenang mengadili...",
          o: [
            "Sengketa kewenangan antarlembaga negara.",
            "Pengujian undang-undang terhadap UUD 1945.",
            "Perkara di tingkat kasasi pada semua peradilan di bawahnya.",
            "Pembubaran partai politik.",
            "Perselisihan hasil pemilihan umum.",
          ],
          a: 2,
        },
        {
          q: "Dalam sistem Trias Politika, kekuasaan legislatif sering diibaratkan sebagai 'pencipta aturan main'. Namun, di Indonesia, kekuasaan legislatif juga memiliki fungsi pengawasan. Hal ini menunjukkan adanya...",
          o: [
            "Inkonsistensi dalam penerapan Trias Politika.",
            "Tumpang tindih (overlapping) kekuasaan yang merugikan.",
            "Implementasi checks and balances yang bersifat rekiprokal (timbal balik).",
            "Dominasi legislatif terhadap cabang kekuasaan lain.",
            "Lemahnya eksekutif dalam menjalankan roda pemerintahan.",
          ],
          a: 2,
        },
        {
          q: "Sebuah kasus korupsi yang melibatkan pejabat eksekutif sedang ditangani oleh KPK. Di saat yang sama, DPR juga membentuk Panitia Kerja (Panja) untuk mengawasi kinerja KPK. Dinamika ini mencerminkan...",
          o: [
            "Konflik kepentingan antara lembaga penegak hukum dan legislatif.",
            "Mekanisme kontrol yang saling mengawasi antarlembaga negara.",
            "Upaya DPR untuk melemahkan proses penegakan hukum.",
            "Ketidakjelasan batas kewenangan antara eksekutif dan legislatif.",
            "Bukti bahwa KPK berada di bawah kendali DPR.",
          ],
          a: 1,
        },
        {
          q: "Jika kita menganalogikan negara sebagai sebuah kapal, maka menurut logika Trias Politika, legislatif adalah yang merancang peta dan aturan pelayaran, eksekutif adalah nahkoda yang mengemudikan, dan yudikatif adalah pengawas yang memastikan semua aturan diikuti. Berdasarkan analogi ini, lembaga seperti BPK dan KY berfungsi sebagai...",
          o: [
            "Awak kapal yang menjalankan perintah nahkoda.",
            "Penumpang yang menikmati perjalanan.",
            "Pelabuhan yang menjadi tujuan akhir.",
            "Nakhkoda cadangan.",
            "Instrumen navigasi dan kompas yang membantu pengawas dan nahkoda.",
          ],
          a: 4,
        },
      ].map((x) => ({
        type: "trias politica",
        q: x.q,
        options: x.o,
        answer: x.a,
      }));

      S_fungsi = shuffle(SOAL_fungsi);

      /*  Validasi jumlah
          if(SINONIM.length!==90||ANTONIM.length!==90){
            console.warn('Jumlah soal tidak 90/90:', SINONIM.length, ANTONIM.length);
          }  */

      // /* Gabung & acak
      function shuffleOptions(q) {
        let opts = q.options.map((opt, i) => ({ opt, i }));
        opts = shuffle(opts); // pake fungsi shuffle yang sudah kamu punya
        let newAnswer = opts.findIndex((o) => o.i === q.answer);
        return {
          ...q,
          options: opts.map((o) => o.opt),
          answer: newAnswer,
        };
      }
      //*/
      let QUESTIONS = [...S_fungsi].map((q, i) => ({
        id: i + 1,
        ...shuffleOptions(q),
      }));
      // let QUESTIONS = [...SINONIM, ...ANTONIM].map((q,i)=>({id:i+1, ...q }));
      // State
      let state = {
        user: null,
        timeLeft: 20 * 60, // 25 menit
        currentIndex: 0,
        answers: Array(180).fill(null), // simpan index jawaban (0..3) atau null
      };

      /** RENDERING **/
      function formatTime(s) {
        const m = Math.floor(s / 60)
          .toString()
          .padStart(2, "0");
        const r = (s % 60).toString().padStart(2, "0");
        return `${m}:${r}`;
      }

      function renderTimer() {
        el("#timer").textContent = formatTime(state.timeLeft);
        if (state.timeLeft <= 60) {
          el("#timer").style.background = "#331a1a";
          el("#timer").style.borderColor = "#7f1d1d";
        }
        if (state.timeLeft <= 0) {
          submitQuiz();
        }
      }

      let tick = null;
      function startTimer() {
        if (tick) clearInterval(tick);
        tick = setInterval(() => {
          state.timeLeft--;
          renderTimer();
          if (state.timeLeft <= 0) clearInterval(tick);
        }, 1000);
      }

      function mountNav() {
        const nav = el("#nav");
        nav.innerHTML = "";
        QUESTIONS.forEach((q, idx) => {
          const b = document.createElement("button");
          b.textContent = idx + 1;
          b.addEventListener("click", () => {
            goTo(idx);
          });
          nav.appendChild(b);
        });
        updateNavActive();
      }

      function updateNavActive() {
        const buttons = els("#nav button");
        buttons.forEach((b, idx) => {
          b.classList.toggle("active", idx === state.currentIndex);
          b.classList.toggle("done", state.answers[idx] !== null);
        });
        el("#infoSoal").textContent = `Soal ${state.currentIndex + 1} / ${
          QUESTIONS.length
        }`;
        el("#infoKategori").textContent = `Kategori: ${QUESTIONS[
          state.currentIndex
        ].type.toUpperCase()}`;
      }

      function renderQuestion() {
        const q = QUESTIONS[state.currentIndex];
        const container = el("#questionArea");
        container.innerHTML = "";
        const title = document.createElement("div");
        title.className = "q-title";

        title.innerHTML = q.q;
        container.appendChild(title);

        const list = document.createElement("div");
        list.className = "choices";
        q.options.forEach((opt, i) => {
          const row = document.createElement("label");
          row.className = "choice";
          const input = document.createElement("input");
          input.type = "radio";
          input.name = "choice";
          input.value = i;
          input.checked = state.answers[state.currentIndex] === i;
          input.addEventListener("change", () => {
            state.answers[state.currentIndex] = i;
            updateNavActive();
          });
          const span = document.createElement("div");
          span.innerHTML = opt;
          row.appendChild(input);
          row.appendChild(span);
          list.appendChild(row);
        });
        container.appendChild(list);
        MathJax.typeset();
      }

      function goTo(idx) {
        state.currentIndex = Math.max(0, Math.min(QUESTIONS.length - 1, idx));
        updateNavActive();
        renderQuestion();
      }

      function next() {
        if (state.currentIndex < QUESTIONS.length - 1) {
          goTo(state.currentIndex + 1);
        }
      }
      function prev() {
        if (state.currentIndex > 0) {
          goTo(state.currentIndex - 1);
        }
      }

      function resetAnswers() {
        if (!confirm("Yakin reset semua jawaban?")) return;
        state.answers = Array(QUESTIONS.length).fill(null);
        updateNavActive();
        renderQuestion();
      }

      function submitQuiz() {
        // hitung skor per kategori
        let sSin = 0,
          sAnt = 0,
          sHip = 0;
        QUESTIONS.forEach((q, idx) => {
          const pick = state.answers[idx];
          const correct = q.answer;
          if (pick === correct) {
            if (q.type === "trias politica") sSin++;
          }
        });
        const total = sSin + sAnt + sHip;

        // tampilkan
        let total_question = QUESTIONS.length;

        el("#scoreTotal").textContent = `${total} / ${total_question}`;
        el("#resultUser").textContent = `Peserta: ${
          state.user?.nama || "-"
        } (waktu habis/kumpul)`;

        // stop timer, ganti section
        if (tick) clearInterval(tick);
        showSection("result");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function showSection(which) {
        el("#section-form").classList.remove("active");
        el("#section-quiz").classList.remove("active");
        el("#section-result").classList.remove("active");
        if (which === "form") el("#section-form").classList.add("active");
        if (which === "quiz") el("#section-quiz").classList.add("active");
        if (which === "result") el("#section-result").classList.add("active");
      }

      // EVENTS
      el("#btnMulai").addEventListener("click", () => {
        const nama = el("#nama").value.trim();
        const pass = el("#pass").value.trim();
        if (!nama || !pass) {
          alert("Nama dan password wajib diisi.");
          return;
        }
        if (pass !== "DPR") {
          alert(
            "password salah! tanya password ke sir hardi. klo sir hardi dak tau tanya ke sir meca"
          );
          return;
        }
        state.user = { nama, pass };
        el("#infoUser").textContent = `Peserta: ${nama}`;
        showSection("quiz");
        startTimer();
        mountNav();
        goTo(0);
        renderTimer();
      });

      el("#prevBtn").addEventListener("click", prev);
      el("#nextBtn").addEventListener("click", next);
      el("#btnReset").addEventListener("click", resetAnswers);
      el("#btnSubmit").addEventListener("click", () => {
        if (confirm("Kumpulkan jawaban sekarang?")) submitQuiz();
      });

      // Keyboard nav: panah kiri/kanan, angka 1-4 untuk memilih A-D
      window.addEventListener("keydown", (e) => {
        if (!el("#section-quiz").classList.contains("active")) return;
        if (e.key === "ArrowRight") next();
        if (e.key === "ArrowLeft") prev();
        if (["1", "2", "3", "4"].includes(e.key)) {
          const idx = parseInt(e.key) - 1;
          state.answers[state.currentIndex] = idx;
          updateNavActive();
          renderQuestion();
        }
      });

      // Ulang dari hasil
      el("#btnUlang").addEventListener("click", () => {
        state = {
          user: state.user,
          timeLeft: 15 * 60,
          currentIndex: 0,
          answers: Array(180).fill(null),
        };
        QUESTIONS = shuffle(QUESTIONS); // acak ulang urutan
        showSection("quiz");
        startTimer();
        mountNav();
        goTo(0);
        renderTimer();
      });
    </script>
  </body>
</html>
