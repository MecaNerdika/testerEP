<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kuis Operasi Pecahan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- MathJax -->
<script>
window.MathJax = {
  tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]},
  svg: {fontCache: 'global'}
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" defer></script>

<style>
body{
  font-family: system-ui, sans-serif;
  background:#f4f6fb;
  margin:0;
}
.container{
  max-width:460px;
  margin:40px auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}
h1{text-align:center}
button{
  padding:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.start{width:100%;background:#2e2da4;color:#fff;font-weight:600}
.option{
  display:block;
  width:100%;
  margin:8px 0;
  background:#f0f2ff;
}
.option:hover{background:#dfe3ff}
.correct{background:#c8f7c5!important}
.wrong{background:#ffd6d6!important}
.timer{text-align:center;font-weight:700}
.feedback{text-align:center;font-weight:600;margin:10px 0}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<h1>Kuis Operasi Pecahan</h1>

<div id="setup">
  <label>Waktu latihan (menit)</label>
  <input id="timeInput" type="number" min="1" value="3" style="width:100%">
  <button class="start" onclick="start()">Mulai</button>
</div>

<div id="quiz" class="hidden">
  <div class="timer" id="timer"></div>
  <h3 id="question"></h3>
  <div id="options"></div>
  <div class="feedback" id="feedback"></div>
</div>

<div id="result" class="hidden">
  <h3>Rekap</h3>
  <p>Total: <b id="total"></b></p>
  <p>Benar: <b id="benar"></b></p>
  <p>Salah: <b id="salah"></b></p>
</div>

</div>

<script>
let a,b,c,d,num,den,op;
let timeLeft,timerInterval;
let benar=0,salah=0;

const rand=(x,y)=>Math.floor(Math.random()*(y-x+1))+x;
const gcd=(x,y)=>y===0?Math.abs(x):gcd(y,x%y);
const lcm=(x,y)=>x*y/gcd(x,y);

/* konversi ke pecahan campuran (untuk tampilan) */
function toMixed(n,d){
  const sign=n<0?"-":"";
  n=Math.abs(n);
  if(n%d===0) return `${sign}${n/d}`;
  if(n<d) return `${sign}\\frac{${n}}{${d}}`;
  return `${sign}${Math.floor(n/d)}\\frac{${n%d}}{${d}}`;
}

function generateQuestion(){
  a=rand(1,20); b=rand(1,20);
  c=rand(1,20); d=rand(1,20);

  const ops=["+","-","\\times","\\div"];
  op=ops[rand(0,3)];

  if(op==="+"||op==="-"){
    const m=lcm(b,d);
    num=(m/b)*a + (op==="+"?(m/d)*c:-(m/d)*c);
    den=m;
  }
  else if(op==="\\times"){
    num=a*c;
    den=b*d;
  }
  else{
    num=a*d;
    den=b*c;
  }

  const g=gcd(num,den);
  if(g>1){num/=g;den/=g;}

  question.innerHTML=
    `Tentukan hasil operasi berikut:<br><br>
     $$\\frac{${a}}{${b}} ${op} \\frac{${c}}{${d}}$$`;

  generateOptions();
  MathJax.typesetPromise();
}

function generateOptions(){
  const correct=toMixed(num,den);
  let set=new Set([correct]);

  while(set.size<5){
    let n=num+rand(-5,5);
    if(n!==0) set.add(toMixed(n,den));
  }

  options.innerHTML="";
  [...set].sort(()=>Math.random()-0.5).forEach(v=>{
    const btn=document.createElement("button");
    btn.className="option";
    btn.innerHTML=`$$${v}$$`;
    btn.onclick=()=>check(v,btn);
    options.appendChild(btn);
  });

  feedback.textContent="";
  MathJax.typesetPromise();
}

function check(val,btn){
  if(val===toMixed(num,den)){
    benar++;
    btn.classList.add("correct");
    feedback.textContent="✔ Benar";
    setTimeout(generateQuestion,600);
  }else{
    salah++;
    btn.classList.add("wrong");
    feedback.textContent="✖ Salah";
  }
}

function start(){
  timeLeft=parseInt(timeInput.value)*60;
  benar=0;salah=0;

  setup.classList.add("hidden");
  quiz.classList.remove("hidden");

  timerInterval=setInterval(()=>{
    timer.textContent=`Sisa waktu: ${timeLeft} detik`;
    if(--timeLeft<0) end();
  },1000);

  generateQuestion();
}

function end(){
  clearInterval(timerInterval);
  quiz.classList.add("hidden");
  result.classList.remove("hidden");

  total.textContent=benar+salah;
  document.getElementById("benar").textContent=benar;
  document.getElementById("salah").textContent=salah;
}
</script>
</body>
</html>
